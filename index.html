<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caféer i Europas huvudstäder</title>

    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        #map {position: absolute; top: 0; bottom: 0; left: 0; right: 0;}
        .legend {
            background: white;
            padding: 8px;
            font-size: 14px;
            line-height: 18px;
            color: #333;
        }
        .legend div {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }
        .legend span {
            display: inline-block;
            border-radius: 50%;
            background: red;
            opacity: 0.6;
            margin-right: 6px;
        }
    </style>
</head>
<body>
<div id="map"></div>

<script>
    // Initiera kartan
    var map = L.map('map').setView([54, 15], 4);
    L.tileLayer('https://api.maptiler.com/maps/basic-v2/{z}/{x}/{y}.png?key=4eMORuMuzGfsSdNZqHP4', {
        attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> ' +
            '<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',
    }).addTo(map);

    // Lista med några europeiska huvudstäder (du kan lägga till fler)
  var capitals = [
    {name: "Vienna", coords: [48.2082, 16.3738]},         // Österrike
    {name: "Minsk", coords: [53.9, 27.5667]},             // Belarus
    {name: "Brussels", coords: [50.8503, 4.3517]},        // Belgien
    {name: "Sarajevo", coords: [43.8563, 18.4131]},       // Bosnien-Hercegovina
    {name: "Sofia", coords: [42.6977, 23.3219]},          // Bulgarien
    {name: "Zagreb", coords: [45.815, 15.9785]},          // Kroatien
    {name: "Nicosia", coords: [35.1856, 33.3823]},        // Cypern
    {name: "Prague", coords: [50.0755, 14.4378]},         // Tjeckien
    {name: "Copenhagen", coords: [55.6761, 12.5683]},     // Danmark
    {name: "Tallinn", coords: [59.437, 24.7536]},         // Estland
    {name: "Helsinki", coords: [60.1699, 24.9384]},       // Finland
    {name: "Paris", coords: [48.8566, 2.3522]},           // Frankrike
    {name: "Tbilisi", coords: [41.7151, 44.8271]},        // Georgien
    {name: "Berlin", coords: [52.52, 13.405]},            // Tyskland
    {name: "Athens", coords: [37.9838, 23.7275]},         // Grekland
    {name: "Budapest", coords: [47.4979, 19.0402]},       // Ungern
    {name: "Reykjavik", coords: [64.1355, -21.8954]},     // Island
    {name: "Dublin", coords: [53.3331, -6.2489]},         // Irland
    {name: "Rome", coords: [41.9028, 12.4964]},           // Italien
    {name: "Pristina", coords: [42.6629, 21.1655]},       // Kosovo
    {name: "Riga", coords: [56.9496, 24.1052]},           // Lettland
    {name: "Vilnius", coords: [54.6872, 25.2797]},        // Litauen
    {name: "Luxembourg", coords: [49.6117, 6.13]},        // Luxemburg
    {name: "Valletta", coords: [35.8997, 14.5146]},       // Malta
    {name: "Chisinau", coords: [47.0105, 28.8638]},       // Moldavien
    {name: "Monaco", coords: [43.7384, 7.4246]},          // Monaco
    {name: "Podgorica", coords: [42.441, 19.2627]},       // Montenegro
    {name: "Amsterdam", coords: [52.3676, 4.9041]},       // Nederländerna
    {name: "Oslo", coords: [59.9139, 10.7522]},           // Norge
    {name: "Warsaw", coords: [52.2297, 21.0122]},         // Polen
    {name: "Lisbon", coords: [38.7169, -9.139]},          // Portugal
    {name: "Bucharest", coords: [44.4268, 26.1025]},      // Rumänien
    {name: "Belgrade", coords: [44.8176, 20.4569]},       // Serbien
    {name: "Bratislava", coords: [48.1486, 17.1077]},     // Slovakien
    {name: "Ljubljana", coords: [46.0569, 14.5058]},      // Slovenien
    {name: "Madrid", coords: [40.4168, -3.7038]},         // Spanien
    {name: "Stockholm", coords: [59.3293, 18.0686]},      // Sverige
    {name: "Bern", coords: [46.9481, 7.4474]},            // Schweiz
    {name: "Kyiv", coords: [50.4501, 30.5234]},           // Ukraina
    {name: "London", coords: [51.5072, -0.1276]}          // Storbritannien
];

    // Funktion för att hämta cafédata från Overpass
    function getCafes(capital) {
        var query = `
            [out:json][timeout:25];
            (
              node["amenity"="cafe"](around:1000,${capital.coords[0]},${capital.coords[1]});
              way["amenity"="cafe"](around:1000,${capital.coords[0]},${capital.coords[1]});
              relation["amenity"="cafe"](around:1000,${capital.coords[0]},${capital.coords[1]});
            );
            out count;
        `;

        fetch("https://overpass-api.de/api/interpreter", {
            method: "POST",
            body: query
        })
        .then(res => res.json())
        .then(data => {
            var count = 0;

            // Kontrollera att vi fått data
            if (data.elements.length > 0 && data.elements[0].tags && data.elements[0].tags.total) {
                count = parseInt(data.elements[0].tags.total);
            }

            // Rita bubbla (storleken beror på antal caféer)
            var circle = L.circleMarker(capital.coords, {
                radius: Math.max(4, Math.sqrt(count) * 0.5), // minsta radie 4 så man alltid ser bubblan
                fillColor: "red",
                color: "darkred",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.6
            }).addTo(map);

            // Popup med namn och antal caféer
            circle.bindPopup(`<b>${capital.name}</b><br>Caféer: ${count}`);
        })
        .catch(err => console.error("Fel vid hämtning för " + capital.name, err));
    }

    // Kör alla städer men med fördröjning (så API:t hinner svara)
    capitals.forEach((c, i) => {
        setTimeout(() => getCafes(c), i * 3000); // 3 sek mellan varje request
    });

    // Lägg till legend
    var legend = L.control({position: 'bottomright'});
    legend.onAdd = function () {
        var div = L.DomUtil.create('div', 'legend');
        div.innerHTML += "<b>Antal caféer</b><br>";

        var sizes = [50, 100, 250, 500, 1000];
        sizes.forEach(s => {
            var r = Math.sqrt(s) * 0.5;
            div.innerHTML +=
                `<div><span style="width:${r * 2}px; height:${r * 2}px;"></span>${s}</div>`;
        });

        return div;
    };
    legend.addTo(map);
</script>
</body>
</html>
